{% load static %}

<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Comic Tasker</title>
        <meta name="description" content="" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>
            Laravel 9 Ajax FullCalender CRUD (Create, Read, Update and Delete)
        </title>

        {% comment %} Javascript {% endcomment %}
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.css"
        />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.js"></script>

        {% comment %} Fonts {% endcomment %}
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
            rel="stylesheet"
        />

        {% comment %} CSS {% endcomment %}
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
            crossorigin="anonymous"
        />
        <link href="{% static 'app/css/reset.css' %}" rel="stylesheet" />
        <link href="{% static 'app/css/styles.css' %}" rel="stylesheet" />
        <link href="{% static 'app/css/header.css' %}" rel="stylesheet" />
        <link href="{% static 'app/css/buttons.css' %}" rel="stylesheet" />
        <link href="{% static 'app/css/footer.css' %}" rel="stylesheet" />
    </head>
    <body>
        <!-- Header -->
        <header id="header" class="header">
            {% include 'app/header.html' %}
        </header>

        <div class="container">
            <div class="row" style="margin-top: 20px">
                <h4></h4>
                {% block content %}{% endblock %}
            </div>
        </div>
        <script>
            $(document).ready(function () {
                var calendar = $("#calendar").fullCalendar({
                    header: {
                        left: "prev,next today",
                        center: "title",
                        right: "month,agendaWeek,agendaDay",
                    },
                    events: "/all_events",
                    selectable: true,
                    selectHelper: true,
                    editable: true,
                    eventLimit: true,
                    select: function (start, end, allDay) {
                        var title = prompt("Enter Event Title");
                        if (title) {
                            var start = $.fullCalendar.formatDate(
                                start,
                                "Y-MM-DD HH:mm:ss"
                            );
                            var end = $.fullCalendar.formatDate(
                                end,
                                "Y-MM-DD HH:mm:ss"
                            );
                            $.ajax({
                                type: "GET",
                                url: "/add_event",
                                data: { title: title, start: start, end: end },
                                dataType: "json",
                                success: function (data) {
                                    calendar.fullCalendar("refetchEvents");
                                    {% comment %} alert("Added Successfully"); {% endcomment %}
                                },
                                error: function (data) {
                                    alert("There is a problem!!!");
                                },
                            });
                        }
                    },
                    eventResize: function (event) {
                        var start = $.fullCalendar.formatDate(
                            event.start,
                            "Y-MM-DD HH:mm:ss"
                        );
                        var end = $.fullCalendar.formatDate(
                            event.end,
                            "Y-MM-DD HH:mm:ss"
                        );
                        var title = event.title;
                        var id = event.id;
                        $.ajax({
                            type: "GET",
                            url: "/update",
                            data: {
                                title: title,
                                start: start,
                                end: end,
                                id: id,
                            },
                            dataType: "json",
                            success: function (data) {
                                calendar.fullCalendar("refetchEvents");
                                alert("Event Update");
                            },
                            error: function (data) {
                                alert("There is a problem!!!");
                            },
                        });
                    },

                    eventDrop: function (event) {
                        var start = $.fullCalendar.formatDate(
                            event.start,
                            "Y-MM-DD HH:mm:ss"
                        );
                        var end = $.fullCalendar.formatDate(
                            event.end,
                            "Y-MM-DD HH:mm:ss"
                        );
                        var title = event.title;
                        var id = event.id;
                        $.ajax({
                            type: "GET",
                            url: "/update",
                            data: {
                                title: title,
                                start: start,
                                end: end,
                                id: id,
                            },
                            dataType: "json",
                            success: function (data) {
                                calendar.fullCalendar("refetchEvents");
                                {% comment %} alert("Event Update"); {% endcomment %}
                            },
                            error: function (data) {
                                alert("There is a problem!!!");
                            },
                        });
                    },

                    eventClick: function (event) {
                        var action = confirm("Mark as Completed? Click 'Cancel' to remove.");

                        if (action) {
                            var id = event.id;
                            $.ajax({
                                type: "GET",
                                url: "/complete_event",
                                data: { id: id },
                                dataType: "json",
                                success: function (data) {
                                    calendar.fullCalendar("refetchEvents");  
                                    {% comment %} alert("Event marked as Completed"); {% endcomment %}
                                },
                                error: function (data) {
                                    alert("There is a problem!!!");
                                },
                            });
                        } else {
                            var remove = confirm("Are you sure you want to remove it?");
                            if (remove) {
                                var id = event.id;
                                $.ajax({
                                    type: "GET",
                                    url: "/remove_event",
                                    data: { id: id },
                                    dataType: "json",
                                    success: function (data) {
                                        calendar.fullCalendar("refetchEvents");
                                        {% comment %} alert("Event Removed"); {% endcomment %}
                                    },
                                    error: function (data) {
                                        alert("There is a problem!!!");
                                    },
                                });
                            }
                        }
                    },


                });
            });
        </script>
    </body>
</html>
